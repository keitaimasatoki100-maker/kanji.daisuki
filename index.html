<!doctype html>
<html lang="ja">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¼¢å­—ç·´ç¿’ã‚µã‚¤ãƒˆ</title>
  <style>
        body {
            font-family: 'UD ãƒ‡ã‚¸ã‚¿ãƒ« æ•™ç§‘æ›¸ä½“ N-R', 'UD Digi Kyokasho N-R', 'UDãƒ‡ã‚¸ã‚¿ãƒ«æ•™ç§‘æ›¸ä½“ N-R', 'UDãƒ‡ã‚¸ã‚¿ãƒ«æ•™ç§‘æ›¸ä½“', 'æ•™ç§‘æ›¸ä½“', 'Kyokasho', 'BIZ UDPGothic', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            writing-mode: vertical-rl;
            text-orientation: upright;
            padding-top: 10px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-height: 95vh;
            height: 100%;
            text-align: center;
            writing-mode: vertical-rl;
            text-orientation: upright;
            overflow-y: auto;
            margin-top: 0;
            position: relative;
        }
        
        .title {
            color: #4a5568;
            font-size: 2rem;
            font-weight: bold;
            margin-left: 10px;
            margin-bottom: 10px;
            writing-mode: vertical-rl;
            text-orientation: upright;
        }
        
        .sentence-card {
            background: #f7fafc;
            border-radius: 15px;
            padding: 15px;
            margin: 0 10px;
            border-top: 5px solid #667eea;
            writing-mode: vertical-rl;
            text-orientation: upright;
            display: inline-block;
            vertical-align: top;
            min-height: 400px;
            width: 55px;
            position: relative;
        }
        
        .problem-number {
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1.2rem;
            font-weight: bold;
            color: #667eea;
            background: white;
            padding: 5px 10px;
            border-radius: 15px;
            border: 2px solid #667eea;
            writing-mode: vertical-rl;
            text-orientation: upright;
        }
        
        .sentence {
            font-size: 1.5rem;
            line-height: 1.8;
            color: #2d3748;
            writing-mode: vertical-rl;
            text-orientation: upright;
            margin-top: 10px;
        }
        
        .kanji-blank {
            display: inline-block;
            width: 40px;
            min-height: 40px;
            border: 2px dashed #cbd5e0;
            border-radius: 8px;
            margin: 0 2px;
            vertical-align: middle;
            background: white;
            position: relative;
            transition: all 0.3s ease;
            padding: 8px 0;
            text-align: center;
            writing-mode: vertical-rl;
            text-orientation: upright;
        }
        
        .kanji-blank::before {
            content: attr(data-reading);
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.8rem;
            color: #2d3748;
            background: #e2e8f0;
            padding: 6px 2px;
            border-radius: 4px;
            white-space: nowrap;
            font-weight: bold;
            writing-mode: vertical-rl;
            text-orientation: upright;
        }
        
        .kanji-blank::after {
            content: '';
            position: absolute;
            top: 50px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .kanji-blank.revealed {
            border: 2px solid #48bb78;
            background: #f0fff4;
            color: #2d3748;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        .reveal-btn {
            background: linear-gradient(135deg, #48bb78, #38a169);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 5px;
            writing-mode: vertical-rl;
            text-orientation: upright;
        }
        
        .individual-btn {
            position: absolute;
            left: -9px;
            top: 50%;
            transform: translateY(-50%);
            padding: 4px 0;
            font-size: 0.6rem;
            margin: 0;
            writing-mode: vertical-rl;
            text-orientation: upright;
            will-change: auto;
            white-space: nowrap;
            z-index: 10;
        }
        
        .individual-btn:hover {
            transform: translateY(-50%);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }
        
        .reveal-btn:hover {
            box-shadow: 0 8px 20px rgba(72, 187, 120, 0.3);
        }
        
        .reveal-btn:disabled {
            background: #e2e8f0;
            color: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .controls {
            margin-right: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            writing-mode: vertical-rl;
            text-orientation: upright;
        }
        
        .reset-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            writing-mode: vertical-rl;
            text-orientation: upright;
        }
        
        .reset-btn:hover {
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.3);
        }
        
        .progress {
            margin-right: 10px;
            font-size: 1.1rem;
            color: #4a5568;
            font-weight: bold;
            writing-mode: vertical-rl;
            text-orientation: upright;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .sentence {
                font-size: 1.2rem;
            }
            
            .title {
                font-size: 1.5rem;
            }
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="container">
   <div style="position: absolute; top: 15px; right: 15px; display: flex; flex-direction: row; align-items: flex-start; gap: 15px; writing-mode: vertical-rl; text-orientation: upright; z-index: 100;">
    <h1 style="color: #4a5568; font-size: 0.6rem; font-weight: bold; margin: 0; writing-mode: vertical-rl; text-orientation: upright; line-height: 1.2;">æ¼¢<br>
     å­—</h1><select id="unitSelector" onchange="filterByUnit()" style="background: white; border: 2px solid #cbd5e0; border-radius: 12px; padding: 8px 12px; font-size: 0.7rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; writing-mode: vertical-rl; text-orientation: upright; min-width: 60px; max-width: 60px; margin-top: 40px;" onmouseover="this.style.borderColor='#667eea'" onmouseout="this.style.borderColor='#cbd5e0'"> <option value="all">ã™ã¹ã¦ã®å˜å…ƒ</option> </select> <select id="rangeSelector" onchange="filterByUnit()" style="background: white; border: 2px solid #cbd5e0; border-radius: 12px; padding: 8px 12px; font-size: 0.7rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; writing-mode: vertical-rl; text-orientation: upright; min-width: 40px; max-width: 40px; margin-top: 10px;" onmouseover="this.style.borderColor='#667eea'" onmouseout="this.style.borderColor='#cbd5e0'"> <option value="up-to">ã¾ã§</option> <option value="only">ã ã‘</option> </select> <button class="shuffle-btn" onclick="shuffleProblems()" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); color: white; border: none; padding: 10px 20px; border-radius: 20px; font-size: 0.9rem; font-weight: bold; cursor: pointer; transition: all 0.3s ease; writing-mode: vertical-rl; text-orientation: upright; margin-top: 40px;" onmouseover="this.style.boxShadow='0 8px 20px rgba(139, 92, 246, 0.3)'" onmouseout="this.style.boxShadow='none'">ã‚·ãƒ£ãƒƒãƒ•ãƒ«</button>
   </div>
   <div style="margin-right: 113px;"></div>
   <div class="sentence-card">
    <div class="problem-number">
     â‘ 
    </div>
    <div class="sentence" id="sentence1">
     ä»Šæ—¥ã¯<span class="kanji-blank" data-kanji="å¤©æ°—" data-reading="ã¦ã‚“ã" id="blank1"><button class="reveal-btn individual-btn" onclick="revealKanji('blank1')">ç­”ãˆ</button></span>ãŒã¨ã¦ã‚‚è‰¯ã„ã§ã™ã€‚
    </div>
   </div>
   <div class="sentence-card">
    <div class="problem-number">
     â‘¡
    </div>
    <div class="sentence" id="sentence2">
     <span class="kanji-blank" data-kanji="å­¦æ ¡" data-reading="ãŒã£ã“ã†" id="blank2"><button class="reveal-btn individual-btn" onclick="revealKanji('blank2')">ç­”ãˆ</button></span>ã§<span class="kanji-blank" data-kanji="å‹é”" data-reading="ã¨ã‚‚ã ã¡" id="blank3"><button class="reveal-btn individual-btn" onclick="revealKanji('blank3')">ç­”ãˆ</button></span>ã¨éŠã³ã¾ã—ãŸã€‚
    </div>
   </div>
   <div class="sentence-card">
    <div class="problem-number">
     â‘¢
    </div>
    <div class="sentence" id="sentence3">
     <span class="kanji-blank" data-kanji="æœ¬" data-reading="ã»ã‚“" id="blank4"><button class="reveal-btn individual-btn" onclick="revealKanji('blank4')">ç­”ãˆ</button></span>ã‚’<span class="kanji-blank" data-kanji="èª­ã‚€" data-reading="ã‚ˆã‚€" id="blank5"><button class="reveal-btn individual-btn" onclick="revealKanji('blank5')">ç­”ãˆ</button></span>ã®ãŒ<span class="kanji-blank" data-kanji="å¥½ã" data-reading="ã™ã" id="blank6"><button class="reveal-btn individual-btn" onclick="revealKanji('blank6')">ç­”ãˆ</button></span>ã§ã™ã€‚
    </div>
   </div>
   <div class="sentence-card">
    <div class="problem-number">
     â‘£
    </div>
    <div class="sentence" id="sentence4">
     <span class="kanji-blank" data-kanji="æ°´" data-reading="ã¿ãš" id="blank7"><button class="reveal-btn individual-btn" onclick="revealKanji('blank7')">ç­”ãˆ</button></span>ã‚’<span class="kanji-blank" data-kanji="é£²ã‚€" data-reading="ã®ã‚€" id="blank8"><button class="reveal-btn individual-btn" onclick="revealKanji('blank8')">ç­”ãˆ</button></span>ã¨<span class="kanji-blank" data-kanji="å…ƒæ°—" data-reading="ã’ã‚“ã" id="blank9"><button class="reveal-btn individual-btn" onclick="revealKanji('blank9')">ç­”ãˆ</button></span>ã«ãªã‚Šã¾ã™ã€‚
    </div>
   </div>
   <div class="sentence-card">
    <div class="problem-number">
     â‘¤
    </div>
    <div class="sentence" id="sentence5">
     <span class="kanji-blank" data-kanji="å±±" data-reading="ã‚„ã¾" id="blank10"><button class="reveal-btn individual-btn" onclick="revealKanji('blank10')">ç­”ãˆ</button></span>ã®<span class="kanji-blank" data-kanji="ä¸Š" data-reading="ã†ãˆ" id="blank11"><button class="reveal-btn individual-btn" onclick="revealKanji('blank11')">ç­”ãˆ</button></span>ã«<span class="kanji-blank" data-kanji="é›ª" data-reading="ã‚†ã" id="blank12"><button class="reveal-btn individual-btn" onclick="revealKanji('blank12')">ç­”ãˆ</button></span>ãŒç©ã‚‚ã£ã¦ã„ã¾ã™ã€‚
    </div>
   </div>
   <div class="sentence-card">
    <div class="problem-number">
     â‘¥
    </div>
    <div class="sentence" id="sentence6">
     <span class="kanji-blank" data-kanji="é›»è»Š" data-reading="ã§ã‚“ã—ã‚ƒ" id="blank13"><button class="reveal-btn individual-btn" onclick="revealKanji('blank13')">ç­”ãˆ</button></span>ã§<span class="kanji-blank" data-kanji="é§…" data-reading="ãˆã" id="blank14"><button class="reveal-btn individual-btn" onclick="revealKanji('blank14')">ç­”ãˆ</button></span>ã¾ã§è¡Œãã¾ã—ãŸã€‚
    </div>
   </div>
   <div class="sentence-card">
    <div class="problem-number">
     â‘¦
    </div>
    <div class="sentence" id="sentence7">
     <span class="kanji-blank" data-kanji="å›³æ›¸é¤¨" data-reading="ã¨ã—ã‚‡ã‹ã‚“" id="blank15"><button class="reveal-btn individual-btn" onclick="revealKanji('blank15')">ç­”ãˆ</button></span>ã§<span class="kanji-blank" data-kanji="å‹‰å¼·" data-reading="ã¹ã‚“ãã‚‡ã†" id="blank16"><button class="reveal-btn individual-btn" onclick="revealKanji('blank16')">ç­”ãˆ</button></span>ã‚’ã—ã¦ã„ã¾ã™ã€‚
    </div>
   </div>
   <div class="sentence-card">
    <div class="problem-number">
     â‘§
    </div>
    <div class="sentence" id="sentence8">
     <span class="kanji-blank" data-kanji="æ–™ç†" data-reading="ã‚Šã‚‡ã†ã‚Š" id="blank17"><button class="reveal-btn individual-btn" onclick="revealKanji('blank17')">ç­”ãˆ</button></span>ã‚’<span class="kanji-blank" data-kanji="ä½œã‚‹" data-reading="ã¤ãã‚‹" id="blank18"><button class="reveal-btn individual-btn" onclick="revealKanji('blank18')">ç­”ãˆ</button></span>ã®ãŒ<span class="kanji-blank" data-kanji="æ¥½ã—ã„" data-reading="ãŸã®ã—ã„" id="blank19"><button class="reveal-btn individual-btn" onclick="revealKanji('blank19')">ç­”ãˆ</button></span>ã§ã™ã€‚
    </div>
   </div>
   <div class="sentence-card">
    <div class="problem-number">
     â‘¨
    </div>
    <div class="sentence" id="sentence9">
     <span class="kanji-blank" data-kanji="éŸ³æ¥½" data-reading="ãŠã‚“ãŒã" id="blank20"><button class="reveal-btn individual-btn" onclick="revealKanji('blank20')">ç­”ãˆ</button></span>ã‚’<span class="kanji-blank" data-kanji="èã" data-reading="ãã" id="blank21"><button class="reveal-btn individual-btn" onclick="revealKanji('blank21')">ç­”ãˆ</button></span>ã¨<span class="kanji-blank" data-kanji="å¿ƒ" data-reading="ã“ã“ã‚" id="blank22"><button class="reveal-btn individual-btn" onclick="revealKanji('blank22')">ç­”ãˆ</button></span>ãŒ<span class="kanji-blank" data-kanji="è½ã¡ç€ã" data-reading="ãŠã¡ã¤ã" id="blank23"><button class="reveal-btn individual-btn" onclick="revealKanji('blank23')">ç­”ãˆ</button></span>ã€‚
    </div>
   </div>
   <div class="sentence-card">
    <div class="problem-number">
     â‘©
    </div>
    <div class="sentence" id="sentence10">
     <span class="kanji-blank" data-kanji="ç§‘å­¦" data-reading="ã‹ãŒã" id="blank24"><button class="reveal-btn individual-btn" onclick="revealKanji('blank24')">ç­”ãˆ</button></span>ã®<span class="kanji-blank" data-kanji="å®Ÿé¨“" data-reading="ã˜ã£ã‘ã‚“" id="blank25"><button class="reveal-btn individual-btn" onclick="revealKanji('blank25')">ç­”ãˆ</button></span>ã¯<span class="kanji-blank" data-kanji="èˆˆå‘³æ·±ã„" data-reading="ãã‚‡ã†ã¿ã¶ã‹ã„" id="blank26"><button class="reveal-btn individual-btn" onclick="revealKanji('blank26')">ç­”ãˆ</button></span>ã§ã™ã€‚
    </div>
   </div>
   <div class="controls"><button class="reveal-btn" onclick="revealAll()">ã™ã¹ã¦è¡¨ç¤º</button> <button class="reveal-btn" onclick="showEditDialog()" style="background: linear-gradient(135deg, #f56565, #e53e3e);">å•é¡Œç·¨é›†</button>
   </div>
  </div><!-- ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
  <div id="editDialog" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
   <div style="background: white; padding: 20px; border-radius: 15px; max-width: 95vw; width: 95%; max-height: 95vh; overflow: auto; display: flex; flex-direction: column; writing-mode: horizontal-tb; text-orientation: mixed; scroll-behavior: smooth;">
    <h2 style="color: #4a5568; margin-bottom: 20px; text-align: center; writing-mode: horizontal-tb; text-orientation: mixed;">å•é¡Œç·¨é›† - ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ</h2>
    <div id="passwordSection" style="writing-mode: horizontal-tb; text-orientation: mixed;"><label style="display: block; margin-bottom: 10px; font-weight: bold; writing-mode: horizontal-tb; text-orientation: mixed;">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:</label> <input type="password" id="passwordInput" style="width: 300px; padding: 10px; border: 2px solid #cbd5e0; border-radius: 8px; margin-bottom: 15px; writing-mode: horizontal-tb;" onkeypress="if(event.key==='Enter') checkPassword()"> <button onclick="checkPassword()" style="background: #48bb78; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; margin-right: 10px; writing-mode: horizontal-tb;">ç¢ºèª</button> <button onclick="closeEditDialog()" style="background: #e2e8f0; color: #4a5568; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; writing-mode: horizontal-tb;">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
    </div>
    <div id="editSection" style="display: none; flex: 1; overflow: hidden; flex-direction: column; writing-mode: horizontal-tb; text-orientation: mixed;">
     <div style="margin-bottom: 15px; display: flex; gap: 10px; align-items: center; flex-wrap: wrap; justify-content: space-between; writing-mode: horizontal-tb; text-orientation: mixed;">
      <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;"><button onclick="saveAndReturn()" style="background: #3b82f6; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-right: 20px; font-weight: bold; writing-mode: horizontal-tb;">ğŸ’¾ ä¿å­˜ã—ã¦æˆ»ã‚‹</button> <button onclick="addRow()" style="background: #3b82f6; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; writing-mode: horizontal-tb;">è¡Œã‚’è¿½åŠ </button> <button onclick="deleteSelectedRows()" style="background: #ef4444; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; writing-mode: horizontal-tb;">é¸æŠè¡Œã‚’å‰Šé™¤</button> <button onclick="clearAll()" style="background: #6b7280; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; writing-mode: horizontal-tb;">ã™ã¹ã¦ã‚¯ãƒªã‚¢</button> <span style="margin-left: 20px; color: #6b7280; writing-mode: horizontal-tb;">Excelãƒ»Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰ç›´æ¥ã‚³ãƒ”ãƒ¼å¯èƒ½</span>
      </div><button onclick="closeEditDialog()" style="background: #e2e8f0; color: #4a5568; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; writing-mode: horizontal-tb; font-weight: bold;">âœ• é–‰ã˜ã‚‹</button>
     </div>
     <div id="spreadsheetContainer" style="flex: 1; overflow: auto; border: 2px solid #d1d5db; border-radius: 8px; background: white; max-height: 60vh; scroll-behavior: smooth; padding-bottom: 20px;">
      <table id="spreadsheetTable" style="width: 100%; border-collapse: collapse; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; writing-mode: horizontal-tb; text-orientation: mixed;"><!-- ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å†…å®¹ãŒã“ã“ã«ç”Ÿæˆã•ã‚Œã‚‹ -->
      </table>
     </div>
     <div style="margin-top: 15px; text-align: center; writing-mode: horizontal-tb; text-orientation: mixed;"><button onclick="saveProblems()" style="background: #48bb78; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-right: 10px; writing-mode: horizontal-tb;">ä¿å­˜ã—ã¦é©ç”¨</button> <button onclick="previewProblems()" style="background: #f59e0b; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; margin-right: 10px; writing-mode: horizontal-tb;">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</button> <button onclick="closeEditDialog()" style="background: #e2e8f0; color: #4a5568; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; writing-mode: horizontal-tb;">é–‰ã˜ã‚‹</button>
     </div>
     <div style="margin-top: 10px; padding: 15px; background: #f0f9ff; border: 1px solid #bae6fd; border-radius: 6px; font-size: 14px; writing-mode: horizontal-tb; text-orientation: mixed;"><strong>ğŸ“ å…¥åŠ›å½¢å¼:</strong> æ¼¢å­—ã®ç©ºæ¬„ã¯ <code>{æ¼¢å­—|èª­ã¿æ–¹}</code> ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„<br><strong>ä¾‹:</strong> ä»Šæ—¥ã¯<code>{å¤©æ°—|ã¦ã‚“ã}</code>ãŒã¨ã¦ã‚‚è‰¯ã„ã§ã™ã€‚<br><strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> Excelã‚„Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§ä½œæˆã—ãŸå•é¡Œã‚’ãã®ã¾ã¾ã‚³ãƒ”ãƒ¼&amp;ãƒšãƒ¼ã‚¹ãƒˆã§ãã¾ã™
     </div>
    </div>
   </div>
  </div>
  <script>
        let revealedCount = 0;
        const totalKanji = 23;
        const correctPassword = "kanji"; // ç·¨é›†ç”¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰
        
        // å•é¡Œãƒ‡ãƒ¼ã‚¿
        let problems = [
            {
                sentence: "ä»Šæ—¥ã¯{å¤©æ°—|ã¦ã‚“ã}ãŒã¨ã¦ã‚‚è‰¯ã„ã§ã™ã€‚",
                unit: "å°å­¦2å¹´ç”Ÿ"
            },
            {
                sentence: "{å­¦æ ¡|ãŒã£ã“ã†}ã§{å‹é”|ã¨ã‚‚ã ã¡}ã¨éŠã³ã¾ã—ãŸã€‚",
                unit: "å°å­¦2å¹´ç”Ÿ"
            },
            {
                sentence: "{æœ¬|ã»ã‚“}ã‚’{èª­ã‚€|ã‚ˆã‚€}ã®ãŒ{å¥½ã|ã™ã}ã§ã™ã€‚",
                unit: "å°å­¦1å¹´ç”Ÿ"
            },
            {
                sentence: "{æ°´|ã¿ãš}ã‚’{é£²ã‚€|ã®ã‚€}ã¨{å…ƒæ°—|ã’ã‚“ã}ã«ãªã‚Šã¾ã™ã€‚",
                unit: "å°å­¦1å¹´ç”Ÿ"
            },
            {
                sentence: "{å±±|ã‚„ã¾}ã®{ä¸Š|ã†ãˆ}ã«{é›ª|ã‚†ã}ãŒç©ã‚‚ã£ã¦ã„ã¾ã™ã€‚",
                unit: "å°å­¦1å¹´ç”Ÿ"
            },
            {
                sentence: "{é›»è»Š|ã§ã‚“ã—ã‚ƒ}ã§{é§…|ãˆã}ã¾ã§è¡Œãã¾ã—ãŸã€‚",
                unit: "å°å­¦3å¹´ç”Ÿ"
            },
            {
                sentence: "{å›³æ›¸é¤¨|ã¨ã—ã‚‡ã‹ã‚“}ã§{å‹‰å¼·|ã¹ã‚“ãã‚‡ã†}ã‚’ã—ã¦ã„ã¾ã™ã€‚",
                unit: "å°å­¦3å¹´ç”Ÿ"
            },
            {
                sentence: "{æ–™ç†|ã‚Šã‚‡ã†ã‚Š}ã‚’{ä½œã‚‹|ã¤ãã‚‹}ã®ãŒ{æ¥½ã—ã„|ãŸã®ã—ã„}ã§ã™ã€‚",
                unit: "å°å­¦4å¹´ç”Ÿ"
            },
            {
                sentence: "{éŸ³æ¥½|ãŠã‚“ãŒã}ã‚’{èã|ãã}ã¨{å¿ƒ|ã“ã“ã‚}ãŒ{è½ã¡ç€ã|ãŠã¡ã¤ã}ã€‚",
                unit: "å°å­¦4å¹´ç”Ÿ"
            },
            {
                sentence: "{ç§‘å­¦|ã‹ãŒã}ã®{å®Ÿé¨“|ã˜ã£ã‘ã‚“}ã¯{èˆˆå‘³æ·±ã„|ãã‚‡ã†ã¿ã¶ã‹ã„}ã§ã™ã€‚",
                unit: "å°å­¦5å¹´ç”Ÿ"
            }
        ];
        
        // å˜å…ƒã®é †åºå®šç¾©ï¼ˆå­¦ç¿’é †åºï¼‰
        const unitOrder = [
            "å°å­¦1å¹´ç”Ÿ",
            "å°å­¦2å¹´ç”Ÿ", 
            "å°å­¦3å¹´ç”Ÿ",
            "å°å­¦4å¹´ç”Ÿ",
            "å°å­¦5å¹´ç”Ÿ",
            "å°å­¦6å¹´ç”Ÿ",
            "ä¸­å­¦1å¹´ç”Ÿ",
            "ä¸­å­¦2å¹´ç”Ÿ",
            "ä¸­å­¦3å¹´ç”Ÿ"
        ];
        
        let currentProblems = [...problems]; // ç¾åœ¨è¡¨ç¤ºä¸­ã®å•é¡Œ
        
        function revealKanji(blankId) {
            const blank = document.getElementById(blankId);
            const button = blank.querySelector('.individual-btn');
            
            if (!blank.classList.contains('revealed')) {
                // æ¼¢å­—ã‚’è¡¨ç¤º
                const kanji = blank.getAttribute('data-kanji');
                blank.innerHTML = kanji + '<button class="reveal-btn individual-btn" onclick="revealKanji(\'' + blankId + '\')">éš ã™</button>';
                blank.classList.add('revealed');
                revealedCount++;
                updateProgress();
                
                // è¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                blank.style.transform = 'scale(1.2)';
                setTimeout(() => {
                    blank.style.transform = 'scale(1)';
                }, 200);
            } else {
                // æ¼¢å­—ã‚’éš ã™
                blank.innerHTML = '<button class="reveal-btn individual-btn" onclick="revealKanji(\'' + blankId + '\')">ç­”ãˆ</button>';
                blank.classList.remove('revealed');
                revealedCount--;
                updateProgress();
                
                // éš ã™ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                blank.style.transform = 'scale(0.8)';
                setTimeout(() => {
                    blank.style.transform = 'scale(1)';
                }, 200);
            }
        }
        
        function revealAll() {
            const allRevealBtn = event.target;
            const blanks = document.querySelectorAll('.kanji-blank');
            
            if (allRevealBtn.textContent === 'ã™ã¹ã¦è¡¨ç¤º') {
                // ã™ã¹ã¦è¡¨ç¤º
                blanks.forEach((blank, index) => {
                    if (!blank.classList.contains('revealed')) {
                        setTimeout(() => {
                            const kanji = blank.getAttribute('data-kanji');
                            const blankId = blank.id;
                            blank.innerHTML = kanji + '<button class="reveal-btn individual-btn" onclick="revealKanji(\'' + blankId + '\')">éš ã™</button>';
                            blank.classList.add('revealed');
                            blank.style.transform = 'scale(1.2)';
                            setTimeout(() => {
                                blank.style.transform = 'scale(1)';
                            }, 200);
                        }, index * 100);
                    }
                });
                
                allRevealBtn.textContent = 'ã™ã¹ã¦éš ã™';
                revealedCount = totalKanji;
            } else {
                // ã™ã¹ã¦éš ã™
                blanks.forEach((blank, index) => {
                    if (blank.classList.contains('revealed')) {
                        setTimeout(() => {
                            const blankId = blank.id;
                            blank.innerHTML = '<button class="reveal-btn individual-btn" onclick="revealKanji(\'' + blankId + '\')">ç­”ãˆ</button>';
                            blank.classList.remove('revealed');
                            blank.style.transform = 'scale(0.8)';
                            setTimeout(() => {
                                blank.style.transform = 'scale(1)';
                            }, 200);
                        }, index * 50);
                    }
                });
                
                allRevealBtn.textContent = 'ã™ã¹ã¦è¡¨ç¤º';
                revealedCount = 0;
            }
            
            updateProgress();
        }
        
        function resetAll() {
            const blanks = document.querySelectorAll('.kanji-blank');
            const allRevealBtn = document.querySelector('.reveal-btn:not(.individual-btn)');
            
            blanks.forEach(blank => {
                const blankId = blank.id;
                blank.innerHTML = '<button class="reveal-btn individual-btn" onclick="revealKanji(\'' + blankId + '\')">ç­”ãˆ</button>';
                blank.classList.remove('revealed');
                blank.style.transform = 'scale(1)';
            });
            
            if (allRevealBtn && allRevealBtn.textContent === 'ã™ã¹ã¦éš ã™') {
                allRevealBtn.textContent = 'ã™ã¹ã¦è¡¨ç¤º';
            }
            
            revealedCount = 0;
            updateProgress();
        }
        
        function updateProgress() {
            const progressElement = document.getElementById('progress');
            progressElement.textContent = `é€²æ—: ${revealedCount}/${totalKanji} æ¼¢å­—`;
            
            if (revealedCount === totalKanji) {
                progressElement.style.color = '#48bb78';
                progressElement.textContent += ' ğŸ‰ å®Œäº†ï¼';
            }
        }
        
        // ç·¨é›†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°é–¢é€£ã®é–¢æ•°
        function showEditDialog() {
            document.getElementById('editDialog').style.display = 'flex';
            document.getElementById('passwordInput').focus();
        }
        
        function closeEditDialog() {
            document.getElementById('editDialog').style.display = 'none';
            document.getElementById('passwordSection').style.display = 'block';
            document.getElementById('editSection').style.display = 'none';
            document.getElementById('passwordInput').value = '';
        }
        
        function checkPassword() {
            const password = document.getElementById('passwordInput').value;
            if (password === correctPassword) {
                document.getElementById('passwordSection').style.display = 'none';
                document.getElementById('editSection').style.display = 'block';
                loadProblemEditor();
            } else {
                alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé–“é•ã£ã¦ã„ã¾ã™ã€‚');
                document.getElementById('passwordInput').value = '';
            }
        }
        
        function loadProblemEditor() {
            createSpreadsheet();
            setupSpreadsheetEvents();
        }
        
        function createSpreadsheet() {
            const table = document.getElementById('spreadsheetTable');
            table.innerHTML = '';
            
            // ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ä½œæˆ
            const headerRow = document.createElement('tr');
            headerRow.innerHTML = `
                <th style="width: 50px; background: #e5e7eb; border: 1px solid #9ca3af; padding: 10px; text-align: center; font-weight: bold; position: sticky; top: 0; z-index: 10; writing-mode: horizontal-tb; text-orientation: mixed;">é¸æŠ</th>
                <th style="width: 80px; background: #e5e7eb; border: 1px solid #9ca3af; padding: 10px; text-align: center; font-weight: bold; position: sticky; top: 0; z-index: 10; writing-mode: horizontal-tb; text-orientation: mixed;">No.</th>
                <th style="width: 200px; background: #e5e7eb; border: 1px solid #9ca3af; padding: 10px; text-align: center; font-weight: bold; position: sticky; top: 0; z-index: 10; writing-mode: horizontal-tb; text-orientation: mixed;">å˜å…ƒå</th>
                <th style="background: #e5e7eb; border: 1px solid #9ca3af; padding: 10px; text-align: center; font-weight: bold; position: sticky; top: 0; z-index: 10; writing-mode: horizontal-tb; text-orientation: mixed;">å•é¡Œæ–‡</th>
            `;
            table.appendChild(headerRow);
            
            // ãƒ‡ãƒ¼ã‚¿è¡Œã‚’ä½œæˆï¼ˆæ—¢å­˜ã®å•é¡Œ + ç©ºè¡Œï¼‰
            const totalRows = Math.max(problems.length + 10, 15);
            
            for (let i = 0; i < totalRows; i++) {
                const problemText = i < problems.length ? problems[i].sentence : '';
                const unitText = i < problems.length ? problems[i].unit : '';
                
                const row = document.createElement('tr');
                row.style.backgroundColor = i % 2 === 0 ? '#ffffff' : '#f9fafb';
                row.innerHTML = `
                    <td style="border: 1px solid #d1d5db; padding: 8px; text-align: center; writing-mode: horizontal-tb; text-orientation: mixed;">
                        <input type="checkbox" class="row-selector" data-row="${i}" style="margin: 0; transform: scale(1.2);">
                    </td>
                    <td style="border: 1px solid #d1d5db; padding: 8px; text-align: center; font-weight: bold; color: #3b82f6; writing-mode: horizontal-tb; text-orientation: mixed;">
                        ${i + 1}
                    </td>
                    <td style="border: 1px solid #d1d5db; padding: 2px; writing-mode: horizontal-tb; text-orientation: mixed;">
                        <input type="text" 
                               class="unit-input" 
                               data-row="${i}" 
                               data-col="0" 
                               value="${unitText}"
                               style="width: 100%; border: none; padding: 10px; outline: none; background: transparent; font-size: 14px; writing-mode: horizontal-tb; text-orientation: mixed; font-family: inherit;"
                               placeholder="å˜å…ƒåï¼ˆä¾‹: å°å­¦3å¹´ç”Ÿï¼‰"
                               onkeydown="handleCellKeydown(event)"
                               onfocus="selectCell(this)"
                               onpaste="handleMultiColumnPaste(event)">
                    </td>
                    <td style="border: 1px solid #d1d5db; padding: 2px; writing-mode: horizontal-tb; text-orientation: mixed;">
                        <input type="text" 
                               class="cell-input" 
                               data-row="${i}" 
                               data-col="1" 
                               value="${problemText}"
                               style="width: 100%; border: none; padding: 10px; outline: none; background: transparent; font-size: 14px; writing-mode: horizontal-tb; text-orientation: mixed; font-family: inherit;"
                               placeholder="å•é¡Œæ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: ä»Šæ—¥ã¯{å¤©æ°—|ã¦ã‚“ã}ãŒã¨ã¦ã‚‚è‰¯ã„ã§ã™ï¼‰"
                               onkeydown="handleCellKeydown(event)"
                               onfocus="selectCell(this)"
                               onpaste="handleMultiColumnPaste(event)">
                    </td>
                `;
                
                table.appendChild(row);
            }
        }
        
        function countBlanks(text) {
            const matches = text.match(/\{[^|]+\|[^}]+\}/g);
            return matches ? matches.length : 0;
        }
        
        function setupSpreadsheetEvents() {
            // å…¨ä½“çš„ãªã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
            document.addEventListener('keydown', function(e) {
                if (document.getElementById('editDialog').style.display === 'flex') {
                    if (e.ctrlKey && e.key === 's') {
                        e.preventDefault();
                        saveProblems();
                    }
                    if (e.ctrlKey && e.key === 'a' && e.target.classList.contains('cell-input')) {
                        // ã‚»ãƒ«å†…ã§ã®Ctrl+Aã¯é€šå¸¸é€šã‚Š
                        return;
                    }
                }
            });
        }
        
        function handleCellKeydown(event) {
            const input = event.target;
            const row = parseInt(input.dataset.row);
            const col = parseInt(input.dataset.col);
            
            switch(event.key) {
                case 'Enter':
                    event.preventDefault();
                    moveToCell(row + 1, col);
                    break;
                case 'Tab':
                    event.preventDefault();
                    if (event.shiftKey) {
                        if (col === 1) {
                            moveToUnitCell(row, 0);
                        } else {
                            moveToCell(row - 1, 1);
                        }
                    } else {
                        if (col === 0) {
                            moveToCell(row, 1);
                        } else {
                            moveToUnitCell(row + 1, 0);
                        }
                    }
                    break;
                case 'ArrowUp':
                    if (event.ctrlKey) {
                        event.preventDefault();
                        moveToCell(row - 1, col);
                    }
                    break;
                case 'ArrowDown':
                    if (event.ctrlKey) {
                        event.preventDefault();
                        moveToCell(row + 1, col);
                    }
                    break;
                case 'Escape':
                    input.blur();
                    break;
            }
        }
        
        function moveToCell(row, col) {
            const nextInput = document.querySelector(`input[data-row="${row}"][data-col="${col}"]`);
            if (nextInput) {
                nextInput.focus();
                nextInput.select();
            }
        }
        
        function moveToUnitCell(row, col) {
            const nextInput = document.querySelector(`input.unit-input[data-row="${row}"][data-col="${col}"]`);
            if (nextInput) {
                nextInput.focus();
                nextInput.select();
            }
        }
        
        function selectCell(input) {
            // ã‚»ãƒ«ãŒé¸æŠã•ã‚ŒãŸã¨ãã®å‡¦ç†
            input.style.background = '#dbeafe';
            input.style.borderRadius = '4px';
            
            // ä»–ã®ã‚»ãƒ«ã®èƒŒæ™¯ã‚’ãƒªã‚»ãƒƒãƒˆ
            document.querySelectorAll('.cell-input, .unit-input').forEach(cell => {
                if (cell !== input) {
                    cell.style.background = 'transparent';
                    cell.style.borderRadius = '0';
                }
            });
        }
        
        function handleMultiColumnPaste(event) {
            event.preventDefault();
            const pastedData = event.clipboardData.getData('text');
            const startRow = parseInt(event.target.dataset.row);
            const startCol = parseInt(event.target.dataset.col);
            
            processMultiColumnPastedData(pastedData, startRow, startCol);
        }
        
        function processMultiColumnPastedData(data, startRow = 0, startCol = 0) {
            const lines = data.split('\n').filter(line => line.trim());
            
            if (lines.length === 0) return;
            
            // å¿…è¦ã«å¿œã˜ã¦è¡Œã‚’è¿½åŠ 
            const currentRowCount = document.querySelectorAll('.cell-input').length;
            const neededRows = startRow + lines.length;
            if (neededRows > currentRowCount) {
                addRows(neededRows - currentRowCount);
            }
            
            let pastedCells = 0;
            
            lines.forEach((line, lineIndex) => {
                const targetRow = startRow + lineIndex;
                const columns = line.split('\t'); // ã‚¿ãƒ–åŒºåˆ‡ã‚Šã§åˆ†å‰²
                
                columns.forEach((cellData, colIndex) => {
                    const targetCol = startCol + colIndex;
                    let input = null;
                    
                    if (targetCol === 0) {
                        // å˜å…ƒååˆ—
                        input = document.querySelector(`input.unit-input[data-row="${targetRow}"][data-col="0"]`);
                    } else if (targetCol === 1) {
                        // å•é¡Œæ–‡åˆ—
                        input = document.querySelector(`input.cell-input[data-row="${targetRow}"][data-col="1"]`);
                    }
                    
                    if (input && cellData.trim()) {
                        input.value = cellData.trim();
                        pastedCells++;
                    }
                });
            });
            
            // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            showMessage(`${pastedCells}å€‹ã®ã‚»ãƒ«ã«ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¾ã—ãŸ`, 'success');
        }
        
        function processPastedData(data, startRow = 0) {
            const lines = data.split('\n').filter(line => line.trim());
            
            if (lines.length === 0) return;
            
            // å¿…è¦ã«å¿œã˜ã¦è¡Œã‚’è¿½åŠ 
            const currentRowCount = document.querySelectorAll('.cell-input').length;
            const neededRows = startRow + lines.length;
            if (neededRows > currentRowCount) {
                addRows(neededRows - currentRowCount);
            }
            
            lines.forEach((line, index) => {
                const targetRow = startRow + index;
                const input = document.querySelector(`input[data-row="${targetRow}"][data-col="1"]`);
                if (input) {
                    input.value = line.trim();
                }
            });
            
            // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            showMessage(`${lines.length}è¡Œã®ãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¾ã—ãŸ`, 'success');
        }
        

        
        function addRow() {
            const table = document.getElementById('spreadsheetTable');
            const currentRows = table.querySelectorAll('tr').length - 1; // ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’é™¤ã
            
            const row = document.createElement('tr');
            row.style.backgroundColor = currentRows % 2 === 0 ? '#ffffff' : '#f9fafb';
            row.innerHTML = `
                <td style="border: 1px solid #d1d5db; padding: 8px; text-align: center; writing-mode: horizontal-tb; text-orientation: mixed;">
                    <input type="checkbox" class="row-selector" data-row="${currentRows}" style="margin: 0; transform: scale(1.2);">
                </td>
                <td style="border: 1px solid #d1d5db; padding: 8px; text-align: center; font-weight: bold; color: #3b82f6; writing-mode: horizontal-tb; text-orientation: mixed;">
                    ${currentRows + 1}
                </td>
                <td style="border: 1px solid #d1d5db; padding: 2px; writing-mode: horizontal-tb; text-orientation: mixed;">
                    <input type="text" 
                           class="unit-input" 
                           data-row="${currentRows}" 
                           data-col="0" 
                           value=""
                           style="width: 100%; border: none; padding: 10px; outline: none; background: transparent; font-size: 14px; writing-mode: horizontal-tb; text-orientation: mixed; font-family: inherit;"
                           placeholder="å˜å…ƒåï¼ˆä¾‹: å°å­¦3å¹´ç”Ÿï¼‰"
                           onkeydown="handleCellKeydown(event)"
                           onfocus="selectCell(this)"
                           onpaste="handleMultiColumnPaste(event)">
                </td>
                <td style="border: 1px solid #d1d5db; padding: 2px; writing-mode: horizontal-tb; text-orientation: mixed;">
                    <input type="text" 
                           class="cell-input" 
                           data-row="${currentRows}" 
                           data-col="1" 
                           value=""
                           style="width: 100%; border: none; padding: 10px; outline: none; background: transparent; font-size: 14px; writing-mode: horizontal-tb; text-orientation: mixed; font-family: inherit;"
                           placeholder="å•é¡Œæ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: ä»Šæ—¥ã¯{å¤©æ°—|ã¦ã‚“ã}ãŒã¨ã¦ã‚‚è‰¯ã„ã§ã™ï¼‰"
                           onkeydown="handleCellKeydown(event)"
                           onfocus="selectCell(this)"
                           onpaste="handleMultiColumnPaste(event)">
                </td>
            `;
            
            table.appendChild(row);
        }
        
        function addRows(count) {
            for (let i = 0; i < count; i++) {
                addRow();
            }
        }
        
        function deleteSelectedRows() {
            const selectedCheckboxes = document.querySelectorAll('.row-selector:checked');
            if (selectedCheckboxes.length === 0) {
                alert('å‰Šé™¤ã™ã‚‹è¡Œã‚’é¸æŠã—ã¦ãã ã•ã„');
                return;
            }
            
            if (confirm(`é¸æŠã—ãŸ${selectedCheckboxes.length}è¡Œã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`)) {
                // å‰Šé™¤ã™ã‚‹è¡Œã‚’é…åˆ—ã«ä¿å­˜ï¼ˆå‰Šé™¤ä¸­ã«NodeListãŒå¤‰ã‚ã‚‹ãŸã‚ï¼‰
                const rowsToDelete = [];
                selectedCheckboxes.forEach(checkbox => {
                    const row = checkbox.closest('tr');
                    if (row) {
                        rowsToDelete.push(row);
                    }
                });
                
                // è¡Œã‚’å‰Šé™¤
                rowsToDelete.forEach(row => {
                    row.remove();
                });
                
                updateRowNumbers();
                showMessage(`${selectedCheckboxes.length}è¡Œã‚’å‰Šé™¤ã—ã¾ã—ãŸ`, 'success');
            }
        }
        
        function clearAll() {
            if (confirm('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹ï¼Ÿã“ã®æ“ä½œã¯å…ƒã«æˆ»ã›ã¾ã›ã‚“ã€‚')) {
                document.querySelectorAll('.cell-input, .unit-input').forEach(input => {
                    input.value = '';
                });
                showMessage('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');
            }
        }
        
        function updateRowNumbers() {
            const rows = document.querySelectorAll('#spreadsheetTable tr:not(:first-child)');
            rows.forEach((row, index) => {
                const numberCell = row.querySelector('td:nth-child(2)');
                const checkbox = row.querySelector('.row-selector');
                const unitInput = row.querySelector('.unit-input');
                const cellInput = row.querySelector('.cell-input');
                
                if (numberCell) numberCell.textContent = index + 1;
                if (checkbox) checkbox.dataset.row = index;
                if (unitInput) {
                    unitInput.dataset.row = index;
                }
                if (cellInput) {
                    cellInput.dataset.row = index;
                }
                
                // è¡Œã®èƒŒæ™¯è‰²ã‚’æ›´æ–°
                row.style.backgroundColor = index % 2 === 0 ? '#ffffff' : '#f9fafb';
            });
        }
        
        function previewProblems() {
            const inputs = document.querySelectorAll('.cell-input');
            const previewProblems = [];
            
            inputs.forEach(input => {
                if (input.value.trim()) {
                    previewProblems.push(input.value.trim());
                }
            });
            
            if (previewProblems.length === 0) {
                showMessage('ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“', 'error');
                return;
            }
            
            let previewText = `ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆ${previewProblems.length}å•ï¼‰:\n\n`;
            previewProblems.forEach((problem, index) => {
                const blankCount = countBlanks(problem);
                previewText += `${index + 1}. ${problem} (ç©ºæ¬„: ${blankCount}å€‹)\n`;
            });
            
            alert(previewText);
        }
        
        function showMessage(message, type = 'info') {
            // ç°¡å˜ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºï¼ˆå®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã‚ˆã‚Šæ´—ç·´ã•ã‚ŒãŸã‚‚ã®ã‚’ä½¿ç”¨ï¼‰
            const color = type === 'success' ? '#059669' : type === 'error' ? '#dc2626' : '#3b82f6';
            
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${color};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                z-index: 10000;
                font-weight: bold;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                writing-mode: horizontal-tb;
                text-orientation: mixed;
            `;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
        

        
        function saveProblems() {
            const newProblems = [];
            
            // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å…¨ã¦ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
            const rows = document.querySelectorAll('#spreadsheetTable tr:not(:first-child)');
            rows.forEach(row => {
                const unitInput = row.querySelector('.unit-input');
                const cellInput = row.querySelector('.cell-input');
                
                if (cellInput && cellInput.value.trim()) {
                    newProblems.push({
                        sentence: cellInput.value.trim(),
                        unit: unitInput ? unitInput.value.trim() : ''
                    });
                }
            });
            
            if (newProblems.length > 0) {
                problems = newProblems;
                currentProblems = [...problems];
                updateUnitSelector();
                regenerateProblems();
                closeEditDialog();
                alert(`${newProblems.length}å€‹ã®å•é¡Œã‚’ä¿å­˜ã—ã¾ã—ãŸï¼`);
            } else {
                alert('å°‘ãªãã¨ã‚‚1ã¤ã®å•é¡Œã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            }
        }
        
        function saveAndReturn() {
            const newProblems = [];
            
            // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å…¨ã¦ã®å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ãƒã‚§ãƒƒã‚¯
            const rows = document.querySelectorAll('#spreadsheetTable tr:not(:first-child)');
            rows.forEach(row => {
                const unitInput = row.querySelector('.unit-input');
                const cellInput = row.querySelector('.cell-input');
                
                if (cellInput && cellInput.value.trim()) {
                    newProblems.push({
                        sentence: cellInput.value.trim(),
                        unit: unitInput ? unitInput.value.trim() : ''
                    });
                }
            });
            
            if (newProblems.length > 0) {
                // 1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®å†…å®¹ã‚’å‡ºé¡Œãƒšãƒ¼ã‚¸ã«åæ˜ 
                problems = newProblems;
                currentProblems = [...newProblems];
                
                // å˜å…ƒã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’æ›´æ–°
                updateUnitSelector();
                
                // å‡ºé¡Œãƒšãƒ¼ã‚¸ã®å•é¡Œã‚’å†ç”Ÿæˆ
                regenerateProblems();
                
                // 2. ç·¨é›†ç”»é¢ã‚’å®Œå…¨ã«é–‰ã˜ã‚‹
                const editDialog = document.getElementById('editDialog');
                editDialog.style.display = 'none';
                
                // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”»é¢ã«æˆ»ã™
                document.getElementById('passwordSection').style.display = 'block';
                document.getElementById('editSection').style.display = 'none';
                document.getElementById('passwordInput').value = '';
                
                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                showMessage(`${newProblems.length}å€‹ã®å•é¡Œã‚’ä¿å­˜ã—ã¦å‡ºé¡Œãƒšãƒ¼ã‚¸ã«åæ˜ ã—ã¾ã—ãŸï¼`, 'success');
                
                // å‡ºé¡Œãƒšãƒ¼ã‚¸ã®æœ€åˆã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆç¸¦æ›¸ããªã®ã§å³ç«¯ã«ç§»å‹•ï¼‰
                setTimeout(() => {
                    window.scrollTo({
                        left: 0,
                        top: 0,
                        behavior: 'smooth'
                    });
                }, 100);
            } else {
                alert('å°‘ãªãã¨ã‚‚1ã¤ã®å•é¡Œã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
            }
        }
        
        function filterByUnit() {
            const selectedUnit = document.getElementById('unitSelector').value;
            const rangeType = document.getElementById('rangeSelector').value;
            
            if (selectedUnit === 'all') {
                currentProblems = [...problems];
            } else {
                if (rangeType === 'only') {
                    // ã€Œã ã‘ã€ï¼šé¸æŠã•ã‚ŒãŸå˜å…ƒã®ã¿è¡¨ç¤º
                    currentProblems = problems.filter(problem => {
                        return problem.unit === selectedUnit;
                    });
                } else {
                    // ã€Œã¾ã§ã€ï¼šé¸æŠã•ã‚ŒãŸå˜å…ƒã‚ˆã‚Šä¸Šã«å…¥åŠ›ã•ã‚ŒãŸå•é¡Œã®ã¿ã‚’è¡¨ç¤ºï¼ˆå•é¡Œç·¨é›†ç”»é¢ã®å…¥åŠ›é †åºã«åŸºã¥ãï¼‰
                    const selectedIndex = unitOrder.indexOf(selectedUnit);
                    
                    // å•é¡Œç·¨é›†ç”»é¢ã§ã®å…¥åŠ›é †åºã‚’è€ƒæ…®ã—ã¦ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
                    currentProblems = [];
                    for (let i = 0; i < problems.length; i++) {
                        const problem = problems[i];
                        const problemIndex = unitOrder.indexOf(problem.unit);
                        
                        // é¸æŠã•ã‚ŒãŸå˜å…ƒãŒè¦‹ã¤ã‹ã£ãŸã‚‰ã€ãã®å•é¡Œã‚’å«ã‚ã¦ãã‚Œã‚ˆã‚Šä¸Šã®å•é¡Œã®ã¿è¿½åŠ 
                        if (problem.unit === selectedUnit) {
                            currentProblems.push(problem);
                            break; // é¸æŠã•ã‚ŒãŸå˜å…ƒãŒè¦‹ã¤ã‹ã£ãŸã‚‰ã€ãã‚Œä»¥é™ã¯é™¤å¤–
                        } else if (problemIndex === -1 || problemIndex < selectedIndex) {
                            // å˜å…ƒé †åºã«ãªã„å ´åˆã€ã¾ãŸã¯é¸æŠã•ã‚ŒãŸå˜å…ƒã‚ˆã‚Šä¸‹ä½ã®å˜å…ƒã®å ´åˆã¯è¿½åŠ 
                            currentProblems.push(problem);
                        } else if (problemIndex > selectedIndex) {
                            // é¸æŠã•ã‚ŒãŸå˜å…ƒã‚ˆã‚Šä¸Šä½ã®å˜å…ƒãŒè¦‹ã¤ã‹ã£ãŸã‚‰ã€ãã‚Œä»¥é™ã¯é™¤å¤–
                            break;
                        } else {
                            // problemIndex === selectedIndex ã®å ´åˆã‚‚è¿½åŠ 
                            currentProblems.push(problem);
                        }
                    }
                }
            }
            
            regenerateProblems();
            
            // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°å®Œäº†ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const selector = document.getElementById('unitSelector');
            const rangeSelector = document.getElementById('rangeSelector');
            const originalBorder = selector.style.borderColor;
            const originalRangeBorder = rangeSelector.style.borderColor;
            
            selector.style.borderColor = '#48bb78';
            selector.style.boxShadow = '0 0 0 3px rgba(72, 187, 120, 0.1)';
            rangeSelector.style.borderColor = '#48bb78';
            rangeSelector.style.boxShadow = '0 0 0 3px rgba(72, 187, 120, 0.1)';
            
            setTimeout(() => {
                selector.style.borderColor = originalBorder;
                selector.style.boxShadow = 'none';
                rangeSelector.style.borderColor = originalRangeBorder;
                rangeSelector.style.boxShadow = 'none';
            }, 1000);
        }
        
        function shuffleProblems() {
            // ç¾åœ¨è¡¨ç¤ºä¸­ã®å•é¡Œã®é †ç•ªã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«å…¥ã‚Œæ›¿ãˆ
            const shuffledProblems = [...currentProblems];
            for (let i = shuffledProblems.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffledProblems[i], shuffledProblems[j]] = [shuffledProblems[j], shuffledProblems[i]];
            }
            
            currentProblems = shuffledProblems;
            regenerateProblems();
            
            // ã‚·ãƒ£ãƒƒãƒ•ãƒ«å®Œäº†ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const shuffleBtn = document.querySelector('.shuffle-btn');
            const originalText = shuffleBtn.textContent;
            shuffleBtn.textContent = 'âœ¨ ã‚·ãƒ£ãƒƒãƒ•ãƒ«å®Œäº†ï¼';
            shuffleBtn.style.background = 'linear-gradient(135deg, #48bb78, #38a169)';
            
            setTimeout(() => {
                shuffleBtn.textContent = originalText;
                shuffleBtn.style.background = 'linear-gradient(135deg, #8b5cf6, #7c3aed)';
            }, 1500);
        }
        
        function updateUnitSelector() {
            const selector = document.getElementById('unitSelector');
            const existingUnits = [...new Set(problems.map(p => p.unit))].filter(unit => unit);
            
            // æ—¢å­˜ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒªã‚¢ï¼ˆã€Œã™ã¹ã¦ã®å˜å…ƒã€ä»¥å¤–ï¼‰
            while (selector.children.length > 1) {
                selector.removeChild(selector.lastChild);
            }
            
            // å®Ÿéš›ã«å…¥åŠ›ã•ã‚ŒãŸå˜å…ƒåã®ã¿ã‚’å˜å…ƒé †åºã«å¾“ã£ã¦è¿½åŠ 
            unitOrder.forEach(unit => {
                if (existingUnits.includes(unit)) {
                    const option = document.createElement('option');
                    option.value = unit;
                    option.textContent = unit;
                    selector.appendChild(option);
                }
            });
            
            // å˜å…ƒé †åºã«ãªã„å˜å…ƒåã‚‚è¿½åŠ ï¼ˆã‚«ã‚¹ã‚¿ãƒ å˜å…ƒåå¯¾å¿œï¼‰
            existingUnits.forEach(unit => {
                if (!unitOrder.includes(unit)) {
                    const option = document.createElement('option');
                    option.value = unit;
                    option.textContent = unit;
                    selector.appendChild(option);
                }
            });
        }
        
        function regenerateProblems() {
            // æ—¢å­˜ã®å•é¡Œã‚«ãƒ¼ãƒ‰ã‚’å‰Šé™¤
            const existingCards = document.querySelectorAll('.sentence-card');
            existingCards.forEach(card => card.remove());
            
            // å•é¡Œæ•°ã‚’æœ€å¤§20å•ã«åˆ¶é™ï¼ˆ21å•ä»¥ä¸Šã®å ´åˆã¯ãƒ©ãƒ³ãƒ€ãƒ ã«20å•é¸æŠï¼‰
            let displayProblems = [...currentProblems];
            if (displayProblems.length > 20) {
                // ãƒ©ãƒ³ãƒ€ãƒ ã«20å•ã‚’é¸æŠ
                const shuffled = [...displayProblems];
                for (let i = shuffled.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                }
                displayProblems = shuffled.slice(0, 20);
            }
            
            // æ–°ã—ã„å•é¡Œã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
            const container = document.querySelector('.container');
            const controlsElement = document.querySelector('.controls');
            
            let blankCounter = 1;
            let totalBlanks = 0;
            
            displayProblems.forEach((problem, problemIndex) => {
                const card = document.createElement('div');
                card.className = 'sentence-card';
                
                // å•é¡Œæ–‡ã‚’è§£æã—ã¦ç©ºæ¬„ã‚’ä½œæˆ
                let processedSentence = problem.sentence;
                const blanks = [];
                
                // {æ¼¢å­—|èª­ã¿æ–¹} ã®å½¢å¼ã‚’æ¤œç´¢
                const regex = /\{([^|]+)\|([^}]+)\}/g;
                let match;
                
                while ((match = regex.exec(problem.sentence)) !== null) {
                    const kanji = match[1];
                    const reading = match[2];
                    const blankId = `blank${blankCounter}`;
                    
                    blanks.push({
                        id: blankId,
                        kanji: kanji,
                        reading: reading
                    });
                    
                    processedSentence = processedSentence.replace(match[0], 
                        `<span class="kanji-blank" data-kanji="${kanji}" data-reading="${reading}" id="${blankId}">` +
                        `<button class="reveal-btn individual-btn" onclick="revealKanji('${blankId}')">ç­”ãˆ</button></span>`
                    );
                    
                    blankCounter++;
                    totalBlanks++;
                }
                
                // ä¸¸å›²ã¿æ•°å­—ã‚’ç”Ÿæˆï¼ˆâ‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨â‘©â‘ªâ‘«â‘¬â‘­â‘®â‘¯â‘°â‘±â‘²â‘³ï¼‰
                const circledNumbers = ['â‘ ', 'â‘¡', 'â‘¢', 'â‘£', 'â‘¤', 'â‘¥', 'â‘¦', 'â‘§', 'â‘¨', 'â‘©', 'â‘ª', 'â‘«', 'â‘¬', 'â‘­', 'â‘®', 'â‘¯', 'â‘°', 'â‘±', 'â‘²', 'â‘³'];
                const problemNumber = problemIndex < circledNumbers.length ? circledNumbers[problemIndex] : `${problemIndex + 1}`;
                
                card.innerHTML = `
                    <div class="problem-number">${problemNumber}</div>
                    <div class="sentence" id="sentence${problemIndex + 1}">${processedSentence}</div>
                `;
                
                container.insertBefore(card, controlsElement);
            });
            
            // å•é¡Œæ•°åˆ¶é™ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
            if (currentProblems.length > 20) {
                showMessage(`${currentProblems.length}å•ä¸­ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«20å•ã‚’é¸æŠã—ã¾ã—ãŸ`, 'info');
            }
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã‚’æ›´æ–°
            window.totalKanji = totalBlanks;
            revealedCount = 0;
            updateProgress();
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å˜å…ƒã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚’åˆæœŸåŒ–
        window.addEventListener('load', function() {
            updateUnitSelector();
            loadProblemsFromEditor();
        });
        
        // ç·¨é›†ç”»é¢ã®å˜å…ƒåã‚’èª­ã¿è¾¼ã‚“ã§åˆæœŸåŒ–
        function loadProblemsFromEditor() {
            // åˆæœŸãƒ‡ãƒ¼ã‚¿ã«å˜å…ƒåã‚’è¨­å®š
            const rows = document.querySelectorAll('#spreadsheetTable tr:not(:first-child)');
            if (rows.length > 0) {
                problems.forEach((problem, index) => {
                    const row = rows[index];
                    if (row) {
                        const unitInput = row.querySelector('.unit-input');
                        if (unitInput) {
                            unitInput.value = problem.unit || '';
                        }
                    }
                });
            }
        }
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9b91e9852675e394',t:'MTc2NzYwNDk1Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
